resourceType: Questionnaire
url: https://aidbox.emr.beda.software/ui/console#/entities/Questionnaire/place-order
meta:
    profile:
        - https://beda.software/beda-emr-questionnaire
name: e-request
title: Laboratory procedure eRequest
status: active
subjectType:
    - Encounter
launchContext:
  - name:
      code: Patient
    type:
      - Patient
  - name:
      code: Author
    type:
      - Practitioner
  - name:
      code: Encounter
    type:
      - Encounter
mapping:
  - id: place-order
    resourceType: Mapping
sourceQueries:
  - localRef: "Bundle#SR"
contained:
  - resourceType: Bundle
    id: SR
    type: batch
    entry:
    - request:
        method: GET
        url: /ServiceRequest
item:
- linkId: test-code
  text: Test Codes
  required: true
  type: string
- linkId: intent
  text: Intent
  required: true
  type: choice
  answerValueSet: http://hl7.org/fhir/ValueSet/request-intent
- linkId: priority
  required: true
  text: Priority
  type: choice
  answerValueSet: http://hl7.org/fhir/ValueSet/request-priority
- linkId: assigned-organization
  text: Assigned organization
  type: reference
  referenceResource:
    - Organization
  required: true
  answerExpression:
    language: application/x-fhir-query
    expression: "Organization?type=lab"
  choiceColumn:
    - forDisplay: true
      path: name
- linkId: patient-id
  type: string
  text: patientId
  readOnly: true
  hidden: true
  initialExpression:
    language: text/fhirpath
    expression: "%Patient.id"
- linkId: encounter-id
  type: string
  text: encounterId
  readOnly: true
  hidden: true
  initialExpression:
    language: text/fhirpath
    expression: "%Encounter.id"
- linkId: practitiner-id
  type: string
  text: practitinerId
  readOnly: true
  hidden: true
  initialExpression:
    language: text/fhirpath
    expression: "%Author.id"
- linkId: barcode
  text: Barcode
  readOnly: true
  type: string
  itemControl:
    coding:
    - code: barcode
  initialExpression:
    language: text/fhirpath
    expression: "'BEDA1212-' &  (%SR.entry.resource.total+1).select('00000'&toString()).toChars().skip(count()-6).join()"
